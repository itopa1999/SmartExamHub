<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Students - SmartExam Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/exam_frontend/css/style.css">
    <link rel="stylesheet" href="/exam_frontend/core/css/manage-students.css">
    <style>

    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <!-- Particle Effect -->
    <div class="particles" id="particles"></div>

    <!-- Preloader -->
    <div id="preloader">
        <div class="preloader-content">
            <div class="loader"></div>
            <div class="loader-content">
                <h3>SmartExams Admin</h3>
                <p>Loading student management system...</p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div>
                    <div class="brand-text">SmartExams Admin</div>
                </div>
            </div>
            
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>

     <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb">
            <div class="breadcrumb-container">
                <a href="index.html" class="breadcrumb-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <span class="breadcrumb-separator">/</span>
                <a href="admin-dashboard.html" class="breadcrumb-link">
                    Admin Dashboard
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Manage Students</span>
            </div>
        </nav>

        <!-- Manage Students Container -->
        <div class="manage-students-container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>Manage Students</h1>
                <p>View, add, edit, and manage student records</p>
            </div>

            <!-- Messages -->
            <div class="message message-success" id="successMessage">
                <i class="fas fa-check-circle message-icon"></i>
                <div>
                    <strong>Success!</strong> <span id="successText">Operation completed successfully.</span>
                </div>
            </div>

            <div class="message message-error" id="errorMessage">
                <i class="fas fa-exclamation-triangle message-icon"></i>
                <div>
                    <strong>Error!</strong> <span id="errorText">There was a problem processing your request.</span>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search students...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <button class="btn btn-primary" id="addStudentBtn">
                    <i class="fas fa-plus"></i> Add New Student
                </button>
            </div>

            <!-- Students Table -->
            <div class="students-table-container">
                <div class="table-header">
                    <h2>Student Records</h2>
                    <div class="pagination-info" id="paginationInfo">
                        Showing 0 of 0 students
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="students-table" id="studentsTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Full Name</th>
                                <th>Class/Level</th>
                                <th>Date Added</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <!-- Students will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-users"></i>
                    <h3>No Students Found</h3>
                    <p>Get started by adding your first student record.</p>
                    <button class="btn btn-primary" id="addFirstStudentBtn" style="margin-top: 1rem;">
                        <i class="fas fa-plus"></i> Add First Student
                    </button>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <div class="pagination-info" id="pageInfo">
                        Page 1 of 1
                    </div>
                    <div class="pagination-controls">
                        <button class="page-btn" id="firstPageBtn" disabled>
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="page-btn" id="prevPageBtn" disabled>
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <div id="pageNumbers">
                            <!-- Page numbers will be generated here -->
                        </div>
                        <button class="page-btn" id="nextPageBtn" disabled>
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="page-btn" id="lastPageBtn" disabled>
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Student Form Modal -->
    <div class="modal-overlay" id="studentModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Add Students</h2>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Upload Toggle -->
                <div class="upload-toggle">
                    <div class="toggle-option active" data-option="single">Single Student</div>
                    <div class="toggle-option" data-option="bulk">Bulk Upload</div>
                </div>

                <!-- Single Student Form -->
                <div id="singleForm" class="form-section">
                    <form id="studentForm">
                        <input type="hidden" id="studentId">
                        <div class="form-group">
                            <label for="fullName" class="form-label">Full Name *</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>
                        <div class="form-group">
                            <label for="studentIdInput" class="form-label">Student ID *</label>
                            <input type="text" class="form-control" id="studentIdInput" required>
                        </div>
                        <div class="form-group">
                            <label for="classLevel" class="form-label">Class/Level *</label>
                            <select class="form-control form-select" id="classLevel" required>
                                <option value="">Select Class/Level</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                                <option value="Grade 7">Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                                <option value="Grade 9">Grade 9</option>
                                <option value="Grade 10">Grade 10</option>
                                <option value="Grade 11">Grade 11</option>
                                <option value="Grade 12">Grade 12</option>
                                <option value="Undergraduate">Undergraduate</option>
                                <option value="Postgraduate">Postgraduate</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- Bulk Upload Section -->
                <div id="bulkForm" class="form-section" style="display: none;">
                    <div class="upload-section-modal" id="uploadSectionModal">
                        <div class="upload-area-modal" id="uploadAreaModal">
                            <div class="upload-icon-modal">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <div class="upload-text-modal">
                                <h4>Upload Student File</h4>
                                <p>Upload an Excel or CSV file with student data</p>
                                
                                <div class="file-types-modal">
                                    <span class="file-type-badge-modal">
                                        <i class="fas fa-file-excel"></i> Excel (.xlsx, .xls)
                                    </span>
                                    <span class="file-type-badge-modal">
                                        <i class="fas fa-file-csv"></i> CSV (.csv)
                                    </span>
                                </div>
                                
                                <button class="browse-btn-modal" id="browseBtnModal">
                                    <i class="fas fa-folder-open"></i> Choose File
                                </button>
                                <input type="file" id="fileInputModal" accept=".xlsx,.xls,.csv">
                            </div>
                        </div>

                        <!-- File Info -->
                        <div class="file-info-modal" id="fileInfoModal">
                            <div class="file-info-header-modal">
                                <i class="fas fa-file-alt file-info-icon-modal"></i>
                                <h5>File Details</h5>
                            </div>
                            <div class="file-details-modal">
                                <div class="file-detail-modal">
                                    <span class="file-detail-label-modal">File Name</span>
                                    <span class="file-detail-value-modal" id="fileNameModal">-</span>
                                </div>
                                <div class="file-detail-modal">
                                    <span class="file-detail-label-modal">File Size</span>
                                    <span class="file-detail-value-modal" id="fileSizeModal">-</span>
                                </div>
                                <div class="file-detail-modal">
                                    <span class="file-detail-label-modal">File Type</span>
                                    <span class="file-detail-value-modal" id="fileTypeModal">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="upload-progress-modal" id="uploadProgressModal">
                            <div class="progress-bar-modal">
                                <div class="progress-fill-modal" id="progressFillModal"></div>
                            </div>
                            <div class="progress-text-modal" id="progressTextModal">Processing file...</div>
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div class="instructions">
                        <h5>File Format Requirements:</h5>
                        <ul>
                            <li>File must be in Excel (.xlsx, .xls) or CSV format</li>
                            <li>Include columns: Full Name, Student ID, Class/Level</li>
                            <li>First row should contain column headers</li>
                            <li>Maximum 1000 students per file</li>
                            <li>File size should not exceed 10MB</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBtn">
                    Cancel
                </button>
                <button class="btn btn-primary" id="saveStudentBtn">
                    Save Student
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-text">
                &copy; 2024 SmartExams Portal. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="/exam_frontend/js/main.js"></script>

    <script>
        // Mock data for demonstration
        let students = JSON.parse(localStorage.getItem('students')) || [
            {
                id: 1,
                studentId: 'STU001',
                fullName: 'John Smith',
                classLevel: 'Grade 10',
                dateAdded: '2024-01-15'
            },
            {
                id: 2,
                studentId: 'STU002',
                fullName: 'Sarah Johnson',
                classLevel: 'Grade 11',
                dateAdded: '2024-01-16'
            },
            {
                id: 3,
                studentId: 'STU003',
                fullName: 'Michael Brown',
                classLevel: 'Grade 9',
                dateAdded: '2024-01-17'
            },
            {
                id: 4,
                studentId: 'STU004',
                fullName: 'Emily Davis',
                classLevel: 'Grade 12',
                dateAdded: '2024-01-18'
            },
            {
                id: 5,
                studentId: 'STU005',
                fullName: 'David Wilson',
                classLevel: 'Undergraduate',
                dateAdded: '2024-01-19'
            }
        ];

        // DOM Elements
        const studentsTableBody = document.getElementById('studentsTableBody');
        const emptyState = document.getElementById('emptyState');
        const searchInput = document.getElementById('searchInput');
        const addStudentBtn = document.getElementById('addStudentBtn');
        const addFirstStudentBtn = document.getElementById('addFirstStudentBtn');
        const studentModal = document.getElementById('studentModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalClose = document.getElementById('modalClose');
        const cancelBtn = document.getElementById('cancelBtn');
        const studentForm = document.getElementById('studentForm');
        const saveStudentBtn = document.getElementById('saveStudentBtn');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const successText = document.getElementById('successText');
        const errorText = document.getElementById('errorText');

        // New elements for bulk upload
        const toggleOptions = document.querySelectorAll('.toggle-option');
        const singleForm = document.getElementById('singleForm');
        const bulkForm = document.getElementById('bulkForm');
        const uploadAreaModal = document.getElementById('uploadAreaModal');
        const uploadSectionModal = document.getElementById('uploadSectionModal');
        const browseBtnModal = document.getElementById('browseBtnModal');
        const fileInputModal = document.getElementById('fileInputModal');
        const fileInfoModal = document.getElementById('fileInfoModal');
        const fileNameModal = document.getElementById('fileNameModal');
        const fileSizeModal = document.getElementById('fileSizeModal');
        const fileTypeModal = document.getElementById('fileTypeModal');
        const uploadProgressModal = document.getElementById('uploadProgressModal');
        const progressFillModal = document.getElementById('progressFillModal');
        const progressTextModal = document.getElementById('progressTextModal');

        // Pagination elements
        const paginationInfo = document.getElementById('paginationInfo');
        const pageInfo = document.getElementById('pageInfo');
        const firstPageBtn = document.getElementById('firstPageBtn');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const pageNumbers = document.getElementById('pageNumbers');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const lastPageBtn = document.getElementById('lastPageBtn');

        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 5;
        let filteredStudents = [];
        let currentUploadMode = 'single'; // 'single' or 'bulk'

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadStudents();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            searchInput.addEventListener('input', handleSearch);
            addStudentBtn.addEventListener('click', openAddModal);
            addFirstStudentBtn.addEventListener('click', openAddModal);
            modalClose.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);
            saveStudentBtn.addEventListener('click', handleSave);
            
            // Toggle options
            toggleOptions.forEach(option => {
                option.addEventListener('click', handleToggleChange);
            });
            
            // Bulk upload events
            browseBtnModal.addEventListener('click', () => fileInputModal.click());
            fileInputModal.addEventListener('change', handleFileSelectModal);
            uploadAreaModal.addEventListener('dragover', handleDragOverModal);
            uploadAreaModal.addEventListener('dragleave', handleDragLeaveModal);
            uploadAreaModal.addEventListener('drop', handleDropModal);
            
            // Pagination events
            firstPageBtn.addEventListener('click', () => goToPage(1));
            prevPageBtn.addEventListener('click', () => goToPage(currentPage - 1));
            nextPageBtn.addEventListener('click', () => goToPage(currentPage + 1));
            lastPageBtn.addEventListener('click', () => goToPage(Math.ceil(filteredStudents.length / itemsPerPage)));
        }

        // Handle toggle change between single and bulk
        function handleToggleChange(e) {
            const option = e.currentTarget.getAttribute('data-option');
            
            toggleOptions.forEach(opt => opt.classList.remove('active'));
            e.currentTarget.classList.add('active');
            
            currentUploadMode = option;
            
            if (option === 'single') {
                singleForm.style.display = 'block';
                bulkForm.style.display = 'none';
                saveStudentBtn.textContent = 'Save Student';
                modalTitle.textContent = 'Add Student';
            } else {
                singleForm.style.display = 'none';
                bulkForm.style.display = 'block';
                saveStudentBtn.textContent = 'Upload Students';
                modalTitle.textContent = 'Bulk Upload Students';
            }
        }

        // Handle file selection for bulk upload
        function handleFileSelectModal(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validate file type
            const validTypes = [
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'text/csv'
            ];
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const isValidType = validTypes.includes(file.type) || 
                              ['xlsx', 'xls', 'csv'].includes(fileExtension);

            if (!isValidType) {
                showError('Please select a valid Excel or CSV file.');
                return;
            }

            // Update file info
            updateFileInfoModal(file);
        }

        // Update file information in modal
        function updateFileInfoModal(file) {
            fileNameModal.textContent = file.name;
            fileSizeModal.textContent = formatFileSize(file.size);
            fileTypeModal.textContent = file.type || `*.${file.name.split('.').pop()}`;
            fileInfoModal.classList.add('show');
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Drag and drop handlers for modal
        function handleDragOverModal(e) {
            e.preventDefault();
            uploadSectionModal.classList.add('active');
        }

        function handleDragLeaveModal(e) {
            e.preventDefault();
            uploadSectionModal.classList.remove('active');
        }

        function handleDropModal(e) {
            e.preventDefault();
            uploadSectionModal.classList.remove('active');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInputModal.files = files;
                handleFileSelectModal({ target: fileInputModal });
            }
        }

        // Show progress for bulk upload
        function showProgressModal() {
            uploadProgressModal.classList.add('show');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                progressFillModal.style.width = progress + '%';
                progressTextModal.textContent = `Processing file... ${Math.round(progress)}%`;
            }, 200);
        }

        // Hide progress for bulk upload
        function hideProgressModal() {
            uploadProgressModal.classList.remove('show');
            progressFillModal.style.width = '0%';
        }

        // Handle save based on current mode
        function handleSave() {
            if (currentUploadMode === 'single') {
                saveStudent();
            } else {
                uploadBulkStudents();
            }
        }

        // Upload bulk students
        function uploadBulkStudents() {
            const file = fileInputModal.files[0];
            if (!file) {
                showError('Please select a file to upload.');
                return;
            }

            showProgressModal();
            
            // Simulate file processing and upload
            setTimeout(() => {
                hideProgressModal();
                
                // Simulate successful upload
                // In a real application, you would send the file to your backend here
                const success = Math.random() > 0.1; // 90% success rate for demo
                
                if (success) {
                    // Simulate adding some students from the file
                    const newStudents = generateMockStudentsFromFile();
                    students.push(...newStudents);
                    localStorage.setItem('students', JSON.stringify(students));
                    
                    showSuccess(`Successfully uploaded ${newStudents.length} students from file.`);
                    closeModal();
                    loadStudents();
                } else {
                    showError('Failed to upload file. Please check the file format and try again.');
                }
            }, 2000);
        }

        // Generate mock students from file (simulation)
        function generateMockStudentsFromFile() {
            const mockStudents = [
                {
                    id: students.length + 1,
                    studentId: `STU${String(students.length + 1).padStart(3, '0')}`,
                    fullName: 'Emma Thompson',
                    classLevel: 'Grade 10',
                    dateAdded: new Date().toISOString().split('T')[0]
                },
                {
                    id: students.length + 2,
                    studentId: `STU${String(students.length + 2).padStart(3, '0')}`,
                    fullName: 'James Wilson',
                    classLevel: 'Grade 11',
                    dateAdded: new Date().toISOString().split('T')[0]
                },
                {
                    id: students.length + 3,
                    studentId: `STU${String(students.length + 3).padStart(3, '0')}`,
                    fullName: 'Olivia Martinez',
                    classLevel: 'Grade 9',
                    dateAdded: new Date().toISOString().split('T')[0]
                }
            ];
            return mockStudents;
        }

        // Load students into table
        function loadStudents() {
            filteredStudents = [...students];
            renderTable();
            updatePagination();
        }

        // Render students table
        function renderTable() {
            studentsTableBody.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                emptyState.style.display = 'block';
                studentsTableBody.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            studentsTableBody.style.display = 'table-row-group';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredStudents.length);
            const currentStudents = filteredStudents.slice(startIndex, endIndex);

            currentStudents.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="student-id">${student.studentId}</td>
                    <td>${student.fullName}</td>
                    <td>${student.classLevel}</td>
                    <td>${formatDate(student.dateAdded)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-sm btn-icon edit-student" data-id="${student.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm btn-icon delete-student" data-id="${student.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                studentsTableBody.appendChild(row);
            });

            // Add event listeners to action buttons
            document.querySelectorAll('.edit-student').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const studentId = e.currentTarget.getAttribute('data-id');
                    editStudent(parseInt(studentId));
                });
            });

            document.querySelectorAll('.delete-student').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const studentId = e.currentTarget.getAttribute('data-id');
                    deleteStudent(parseInt(studentId));
                });
            });
        }

        // Handle search
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredStudents = [...students];
            } else {
                filteredStudents = students.filter(student => 
                    student.fullName.toLowerCase().includes(searchTerm) ||
                    student.studentId.toLowerCase().includes(searchTerm) ||
                    student.classLevel.toLowerCase().includes(searchTerm)
                );
            }
            
            currentPage = 1;
            renderTable();
            updatePagination();
        }

        // Update pagination controls
        function updatePagination() {
            const totalPages = Math.ceil(filteredStudents.length / itemsPerPage);
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, filteredStudents.length);
            
            // Update pagination info
            paginationInfo.textContent = `Showing ${startItem} to ${endItem} of ${filteredStudents.length} students`;
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            
            // Update button states
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            // Generate page numbers
            pageNumbers.innerHTML = '';
            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            
            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => goToPage(i));
                pageNumbers.appendChild(pageBtn);
            }
        }

        // Go to specific page
        function goToPage(page) {
            const totalPages = Math.ceil(filteredStudents.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderTable();
            updatePagination();
        }

        // Open add student modal
        function openAddModal() {
            modalTitle.textContent = 'Add Student';
            studentForm.reset();
            document.getElementById('studentId').value = '';
            
            // Reset to single mode by default
            toggleOptions.forEach(opt => opt.classList.remove('active'));
            document.querySelector('[data-option="single"]').classList.add('active');
            singleForm.style.display = 'block';
            bulkForm.style.display = 'none';
            saveStudentBtn.textContent = 'Save Student';
            currentUploadMode = 'single';
            
            // Reset file upload section
            fileInputModal.value = '';
            fileInfoModal.classList.remove('show');
            hideProgressModal();
            
            studentModal.classList.add('active');
        }

        // Edit student
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            modalTitle.textContent = 'Edit Student';
            document.getElementById('studentId').value = student.id;
            document.getElementById('fullName').value = student.fullName;
            document.getElementById('studentIdInput').value = student.studentId;
            document.getElementById('classLevel').value = student.classLevel;
            
            // Ensure we're in single mode for editing
            toggleOptions.forEach(opt => opt.classList.remove('active'));
            document.querySelector('[data-option="single"]').classList.add('active');
            singleForm.style.display = 'block';
            bulkForm.style.display = 'none';
            saveStudentBtn.textContent = 'Update Student';
            currentUploadMode = 'single';
            
            studentModal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            studentModal.classList.remove('active');
        }

        // Save student (add or update)
        function saveStudent() {
            const id = document.getElementById('studentId').value;
            const fullName = document.getElementById('fullName').value.trim();
            const studentId = document.getElementById('studentIdInput').value.trim();
            const classLevel = document.getElementById('classLevel').value;
            
            // Validation
            if (!fullName || !studentId || !classLevel) {
                showError('Please fill in all required fields.');
                return;
            }
            
            // Check if student ID already exists (for new students)
            if (!id && students.some(s => s.studentId === studentId)) {
                showError('Student ID already exists. Please use a different ID.');
                return;
            }
            
            // Check if student ID already exists (for existing students, excluding current)
            if (id && students.some(s => s.studentId === studentId && s.id !== parseInt(id))) {
                showError('Student ID already exists. Please use a different ID.');
                return;
            }
            
            if (id) {
                // Update existing student
                const index = students.findIndex(s => s.id === parseInt(id));
                if (index !== -1) {
                    students[index] = {
                        ...students[index],
                        fullName,
                        studentId,
                        classLevel
                    };
                }
                showSuccess('Student record updated successfully.');
            } else {
                // Add new student
                const newStudent = {
                    id: students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1,
                    studentId,
                    fullName,
                    classLevel,
                    dateAdded: new Date().toISOString().split('T')[0]
                };
                students.push(newStudent);
                showSuccess('Student added successfully.');
            }
            
            // Save to localStorage
            localStorage.setItem('students', JSON.stringify(students));
            
            // Reload table and close modal
            loadStudents();
            closeModal();
        }

        // Delete student
        function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                return;
            }
            
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            students = students.filter(s => s.id !== id);
            localStorage.setItem('students', JSON.stringify(students));
            
            showSuccess('Student deleted successfully.');
            loadStudents();
        }

        // Show success message
        function showSuccess(message) {
            successText.textContent = message;
            successMessage.classList.add('show');
            errorMessage.classList.remove('show');
            
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 5000);
        }

        // Show error message
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.add('show');
            successMessage.classList.remove('show');
            
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 5000);
        }

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        if (typeof createParticles === 'function') {
                createParticles();
            }

            hidePreloader();
    </script>
</body>
</html>